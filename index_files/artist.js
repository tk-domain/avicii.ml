webpackJsonp([10],{0:function(e,t,i){e.exports=i(367)},367:function(e,t,i){var r,a,n,s,c,o,d,l,u,p;r=i(2),a=i(3),s=i(7),c=i(12),u=i(368),p=i(5),o=i(25).getText,l=i(298),d=i(306),i(361),i(373),i(13),n=i(393),ds.define("artist",function(e){var t,i,m,h,v,f;return t=e("alerts"),h=e("onNextVisit"),f=e("ready"),m=p.getUrl,v={},v.init=function(){var e,t;if(r.pjax.defaults&&(r.pjax.defaults.scrollTo=null!=(t=r("#page_content .tab_menu:first").offset())?t.top:void 0),this.artistID=s["artist/view:artistID"],this.artistID)return e=r("body"),e.on("click",".artist_track_link",this.trackLink).on("click",".edit_master",this.masterEdit).on("click",".credit_type",this.creditFilter).on("submit",".artist_search_form",this.submitSearch).on("click","#mr_a_create",this.createMaster),r(window).on("pjax:start",this.pjaxStart).on("pjax:end",this.pjaxEnd),r(window).on("cards:initialized",function(e){return function(t,i){if(r("#mr_panel").is(":visible"))return e.setupSubCheckboxes(i)}}(this)),c.isMobile?l.setupActionMenuView(e):void 0},v.pjaxStart=function(){var e,t,i,a;return e=r(".credit_type"),i=p.deparam(),a=i.subtype||"All",t=i.recent?".recent":'[data-credit-type="'+i.type+'"][data-credit-subtype="'+a+'"]',i.type||i.recent?(e.filter(".selected").removeClass("selected"),void e.filter(t).addClass("selected")):(e.filter(".selected").removeClass("selected"),void(i.query||e.filter(".default").addClass("selected")))},v.pjaxEnd=function(){var e,t,i;e=p.deparam(),i=e.type,t=e.subtype,r("#mr_panel").is(":visible")&&(v.createMasterCheckboxes(),v.checkSelectedItems()),r(".discography_nav li").find(".icon-spinner").remove(),r(".artist_search_form .icon-spinner").removeClass("icon-spinner icon-spin").addClass("icon-search"),c.isMobile&&(r("#discography_wrapper").removeClass("open"),r(".tab_menu .current .link_text").text(t?t:i))},v.isEmpty=function(){var e;return e=r.trim(this.$discography.html()),a.isBlank(e)},v.hideChildren=function(){r(".default_releases, .discography_wrapper, .search_results").hide()},v.setupSubCheckboxes=function(e){var t,i,r;if((e||v.isEditing)&&(i=e?e:parseInt(v.isEditing.id),t=u.cards.where({objectType:"master release",objectId:i})[0],r=a.where(n.views,{model:t})[0]))return r.toggleVersions(!0).then(function(){return v.createMasterCheckboxes()})},v.checkSelectedItems=function(){var e;if(null!=(e=v.isEditing)?e.versions:void 0)return a.each(v.isEditing.versions,function(e){return r(".r"+e.id).prop("checked",!0)})},v.reset=function(e){var t;e?(t=r("#"+e),t.html("\n")):r("#releases").children().html("\n")},v.trackLink=function(){d.legacyTrack("artist",r(this).data("action"))},v.masterEdit=function(e){var t,i;c.isMobile||(i=r(this).parents("tr"),t=v.getObid(i.get()[0]),"m"===t.charAt(0)&&v.clickMasterEdit(null,t),e.preventDefault())},v.clickMasterEdit=function(e,i){i=i.substr(1),p.requireLogin()&&(r("button.button_mr").prop("disabled",!0),r.ajax({url:m("/master/data"),type:"GET",data:{master_id:i},success:v.startEditMaster,error:function(e){t.alert(p.errorMessageFromXHR(e))}}))},v.startEditMaster=function(e){v.isEditing=e,v.isEditing.originalIds=a.keys(e.versions),v.setupSubCheckboxes(parseInt(e.id,10)),v.createMaster(null,e.id),r("#mr_notes").val(e.notes),v.updateMaster()},v.submitSearch=function(e){var t,i,a,n;e.preventDefault(),e.stopPropagation(),i=r(e.target),a=i.find(".artist_search_query").val(),n=window.location.pathname+"?query="+a,r.support.pjax?(t=r("#pjax_container"),i.find(".icon-search").removeClass("icon-search").addClass("icon-spinner icon-spin"),r(".credit_type.selected").removeClass("selected"),r.pjax({url:n,container:"#pjax_container",timeout:t.data("pjax-timeout")})):window.location.href=n},v.creditFilter=function(e){var t,i;return t=r(this),!t.is(".selected")&&(i=r("#pjax_container"),t.append('<i class="icon icon-spinner icon-spin" />'),r("#search_query").val(""),v.updateDocumentTitleFromCredit(t),void r.pjax.click(e,{container:"#pjax_container",timeout:i.data("pjax-timeout")}))},v.updateDocumentTitleFromCredit=function(e){return document.title=e.attr("data-credit-document-title")},v.getObid=function(e){var t;return t=r(e).attr("class"),t.match(/[a-z][0-9]+/)[0]},v.createMaster=function(e,t){var i,a,n,s,d;c.isMobile||(a=r("#mr_panel"),d=0,i=r("body"),s=r("#mr_save_button"),n=r("#mr_panel_title"),a.length<1||(v.createMasterCheckboxes(),s.html(t?o("Save"):o("Create")()).off("click"),t?s.on("click",{id:t},v.saveMaster):s.click(v.saveMaster),r("#mr_cancel_button").click(v.cancelMaster),a.show(),n.html(t?o("Edit Master Release")():o("Create Master Release")()),d=i.css("margin-bottom").match(/\d+/),d=parseInt(d,10)||0,d+=212,i.css("margin-bottom",d),e&&e.preventDefault()))},v.createMasterCheckboxes=function(){var e;e=r("span.r_check"),e.each(function(){var e,t,i,a;t=r(this),i=v.getObid(t.parents("tr")),"r"===i.charAt(0)&&r(this).find("input").length<1&&(e=r('<input type="checkbox" class="r_check '+i+'" />'),e.prop("checked",!!(null!=(a=v.isEditing)?a.versions[i.substr(1)]:void 0)),t.append(e))}),r("input.r_check:checkbox").off("click").on("click",v.rcheckMaster)},v.enableButtons=function(){r("#mr_save_button").prop("disabled",!1),r("#mr_cancel_button").prop("disabled",!1)},v.disableButtons=function(){r("#mr_save_button").prop("disabled",!0),r("#mr_cancel_button").prop("disabled",!0)},v.rcheckMaster=function(){var e,t,a;e=r(this),t=r("input."+this.className),a=parseInt(v.getObid(e).slice(1),10),t.each(function(){var t;t=r(this),t[0]!==e[0]&&t.prop("checked",e.is(":checked"))}),v.isEditing||(v.isEditing={versions:{},main:a}),e.is(":checked")?v.isEditing.versions[a]={id:a,html:i(a)}:delete v.isEditing.versions[a],v.updateMaster()},v.updateMaster=function(){var t,i;t=r("#mr_panel_inner"),v.override=!1,i=e("templates").editMasterTable({versions:v.isEditing.versions}),t.html(i),r(".r_radio.r"+v.isEditing.main).prop("checked",!0)},v.saveMaster=function(e){var i,n,s,c,d,l,u,f,b,_;if(i=r("input.r_radio"),s=e.data&&e.data.id,c=[],_=[],d=!1,f={data:{}},b=void 0,i.length){if(i.filter(":checked").length>0&&(d=v.getObid(i.filter(":checked")).substr(1)),c=v.isEditing.originalIds,_=a.keys(v.isEditing.versions),n=a(_).difference(c),b=a(c).difference(_),!d)return void t.alert(o("Please select a key release.")());f.data.sub_notes=r("#sub_notes").val(),v.override&&(f.data.override=1),u=r("#mr_notes").val(),s?(u!==encodeURIComponent(v.isEditing.notes)&&(f.data.mr_notes=u),d!==v.isEditing.main&&(f.data.main=d),b.length&&(f.data.remove=b.join(",")),n.length&&(f.data.add=n.join(",")),f.data.master_id=v.isEditing.id,f.url=m("/master/save"),l="edited"):(f.data.ids=a.keys(v.isEditing.versions).join(","),f.data.main=d,f.data.mr_notes=u,f.url=m("/master/new"),l="created"),f.success=function(e){"success"===e.type?v.saveMasterSuccess():"warn"===e.type?v.saveMasterWarn(e.msg):v.saveMasterError(e.msg),h("google.legacyTrack","master release",l,"on artist page",p.getDuration())},f.error=function(e){v.saveMasterError(p.errorMessageFromXHR(e))},f.type="POST",v.disableButtons(),r.ajax(f)}},v.saveMasterSuccess=function(){v.cancelMaster(),t.alert(o("Master release saved successfully and will be processed soon. Please refresh the page in a minute to see the updated discography.")())},v.saveMasterError=function(e){v.enableButtons(),t.alert(o("Error")()+":\n\n"+e)},v.saveMasterWarn=function(e){var i,a,n;a=r("#mr_save_button").html(),n=o("Warning")(),i=o("Click %(saveButton)s again to save anyway.")({saveButton:a}),t.alert(n+":\n\n"+e+"\n\n"+i),v.enableButtons(),v.override=1},v.cancelMaster=function(){var e;e=r("span.r_check"),e.html(""),r("#mr_panel").hide(),r("#mr_panel_inner").html(""),r("#mr_notes").val(""),r("#sub_notes").val(""),v.enableButtons(),r("body").css("margin-bottom",0)},i=function(e){var t,i,a;return a=function(e,t){return t.outerHTML},t=r("#r"+e),i=".image, .title, .label, .year",t.find(i).map(a).get().join("")},f(function(){return v.init()}),v})}});
//# sourceMappingURL=artist.js.map