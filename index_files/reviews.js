webpackJsonp([60],{0:function(e,t,i){e.exports=i(818)},818:function(e,t,i){var r,n,o,s,c,a,u,d,v;r=i(2),o=i(3),n=i(11),s=i(7),u=i(25),v=i(5),c=i(25).getText,d=i(298),a=i(306),i(361),i(819),i(13),i(820),ds.define("reviews",function(e){var t,i,l,w,p,m,f,h,g;return l=v.getUrl,i=e("alerts"),m=e("rating"),f=e("ready"),g=e("tooltip"),p={},t=10,w=!1,h=".review",p.init=function(){var e;return e=r("body"),this.previewTimeout=0,s.loggedIn?s.userIsDbBanned||p.restore():r("#add_new_review").on("click",o.partial(o.defer,v.requireLogin)),e.on("click",".review_action1-reply",p.contextualCompose("reply")),e.on("click",".review_action1-edit",p.contextualCompose("edit")),e.on("click",".review_action2-notify",function(){var e;return e=this.id.replace("rvnotify_",""),p.notify(e)}),e.on("click",".remove_review",p.removeReview),e.on("click",".review .review_tag",p.tag),d.setupActionMenuView(r(h))},p.removeReview=function(e){var t,i,n,s,c;n=r(this),i=n.closest(".review"),t=r(".review").filter(function(){return r(this).data("replyTo")===i.data("cid")}),c=l(i.data("deleteUrl")),s=function(){r.ajax({type:"delete",url:c}),i.fadeOut().promise().then(function(){d.teardown(i),i.remove()}),t.fadeOut().promise().then(function(){return t.each(d.teardown)})},v.confirm(u.getText("Are you certain you would like to delete this review?")()).then(s),o.defer(function(){return r(".ui-dialog-buttonset").find("button:last").focus()}),e.preventDefault()},p.compose=function(e,t,i){var o,s;return o=new n(function(n,o){var s,c;return s=function(e){p.canCompose()&&(p.insertHTML(e,t),p.initCompose(i))},p.canCompose()||p.hideOthers(),v.requireLogin()?(p.composing={resolve:n,reject:o},p.mode=i,c=r.get(e,{styleVersion:!0}),c.then(s,p.alertResponseText),c.fail(o)):o()}),s=function(){return r("#review_compose").remove()},o.then(s,s),o},p.initCompose=function(e){var t,i,n;return e=e||"add",n="add"===e&&o.includeString(location.hash,"add-new-review"),i=r("#review"),p.$reviewWordCount=r("#review-word-count"),t=r("#review_compose"),t.find(".quote_review").on("click",p.quote),r("#reviews_compose_submit").on("click",function(){var t,n;t=r(this),i.prop("disabled",!0),t.prop("disabled",!0),n={edit:c("Saving")(),add:c("Posting")(),reply:c("Replying")()},t.text(n[e]),t.blur()}),r(".reviews-compose-submit-edit").on("click",function(){var e;return e=r(this).data("review-cid"),p.submitEdit(e),!1}),r(".reviews-compose-submit-reply").on("click",function(){var e;return e=r(this).data("review-parent-cid"),p.submitReply(e),!1}),r(".reviews-compose-submit-add").on("click",function(){var e,t;return t=r(this).data("review-what"),e=r(this).data("review-obid"),p.submitAdd(t,e),!1}),r(".reviews-cancel-event").on("click",p.cancelClickHandler),p.validate.call(i),i.on("change keyup",p.preview).on("change keyup",p.validate).on("keyup",p.cancelOnEscape),("add"!==e||n)&&i.focus(),n&&(o.delay(v.scrollTo,i,10),location.hash=""),this},p.validate=function(){var e,i,n,o;n=r.trim(this.value),e=n.length,o=n.split(" ").length,i=o>=t,e&&!i?p.$reviewWordCount.addClass("show").html("<i class='icon icon-exclamation-circle'></i> "+c("At least %(minReviewWordCount)s words must be entered. Please enter at least %(wordsNeeded)s more.")({minReviewWordCount:t,wordsNeeded:t-o})):p.$reviewWordCount.removeClass("show"),r("#review_compose #reviews_compose_submit").prop("disabled",!i)},p.cancelOnEscape=function(e){var t;t=27,e.keyCode===t&&"add"!==p.mode&&p.cancel()},p.canCompose=function(){return r("#review_compose").length<1},p.hideOthers=function(){p.close()},p.add=function(e){return p.compose(e,r("#review_space"),"add")},p.addReviewFromElement=function(e){var t,i;if(t=r(e),i=t.data("reviews-add-url"))return p.add(i)},p.contextualCompose=function(e){return function(){var t,i,n,o,s;return t=r(this),i=t.closest(".review"),w=i.hasClass("is_showing_object"),g.setup(i),s=l("/reviews/"+e+"?id="+i.data("cid")),i.addClass(e+"ing"),n=p.compose(s,i,e),o=function(){return i.removeClass(e+"ing")},n.then(o,o),"edit"===e&&n.then(function(){return i.remove()}),n}},p.preview=function(e){var t;p.previewTimeout&&clearTimeout(p.previewTimeout),t=v.toString((new Date).getTime()).replace(/\D/gi,""),r(e.target).parent().find("div.review_preview").attr("id",t),p.previewTimeout=o.delay(p.doPreview,750,t)},p.doPreview=function(e){var t;return e=r(e.target?e.target:e),t=r("#review").val(),r(".review_preview_wrap").toggle(r.trim(t).length>0),r.post(l("/reviews/preview"),{comment:t,styleVersion:!0},function(e){r(".review_preview").html(e)})},p.submit=function(e,t){return new n(function(i,n){var o,s,c,u;return s=p.mode,c=function(e){var t;p.insertHTML(e,r("#review_compose")),t=r("#parent").val(),t&&p.notify(t,1),p.reset(),p.composing.resolve(o),m.init(),d.setupActionMenuView(r(h))},v.requireLogin()?(o=r("#review").val(),"add"!==s&&"edit"!==s||(t.is_review=Number(r("#is_review").is(":checked"))),t.notify=Number(r("#notify").is(":checked")),t.comment=o,t.styleVersion=!0,t.show_object=w,u=r.post(l("/reviews/"+e),t),u.then(c,p.alertResponseText),u.then(p.restore),u.then(i,n),u.then(function(){return a.legacyTrack("review",s,t.what)})):n()})},p.alertResponseText=function(e){return i.alert(e.responseText)},p.submitAdd=function(e,t){return p.submit("post",{what:e,obid:t})},p.submitReply=function(e){return p.submit("post",{id:e})},p.submitEdit=function(e){return p.submit("save",{id:e})},p.cancel=function(){return p.close(),p.restore()},p.restore=function(){return p.addReviewFromElement(r("#review_space"))},p.cancelClickHandler=function(e){p.cancel(),e.preventDefault()},p.close=function(){p.composing&&(p.composing.reject(),r("#review_compose").remove())},p.reset=function(){r("#review").val(""),r(".review_preview_wrap").hide()},p.insertHTML=function(e,t){var i,n;return i=r(t),n=r(r.trim(e)),i.after(n),g.setup(n),i},p.tag=function(){var e,t,i,n;if(t=r(this),e=t.parents(".review_content"),i=0,n=1,v.requireLogin()){if(e.length>0&&e.attr("id")&&(i=e.attr("id").replace("c","")),!i||!n)return;r.post(l("/reviews/tag"),{cid:i,tid:n,styleVersion:!0},function(){return r("#tags_rv"+i).css("font-weight","bold"),window.location.reload()})}return!1},p.quote=function(e){var t,i,n,s;t=r("#review_compose").prev(".review"),n=t.find("a.user").first().html(),i=r.trim(t.find("div.review_comment").first().html()),s="[quote="+n+"] "+i+" [/quote]\n",s+=r("#review").val(),s=o.stripTags(s),r("#review").val(s).focus(),p.preview(e)},p.notify=function(e,t){var i;if(v.requireLogin())return i=r("#rvnotify_"+e),r.post(l("/reviews/notify"),{id:e,peek:t,styleVersion:!0},function(e){i.html(o.capitalize(e))})},f(function(){return p.init()}),p})}});
//# sourceMappingURL=reviews.js.map